<!DOCTYPE html>
{% load static %}
<html lang="sv" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ site_settings.title|default:"Yxsamling" }}{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.bootstrap5.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/3.0.2/css/buttons.bootstrap5.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/3.0.2/css/responsive.bootstrap5.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            padding-top: 56px;
        }
        .stats-card {
            transition: transform 0.2s;
        }
        .stats-card:hover {
            transform: translateY(-5px);
        }
        .sold-axe {
            opacity: 0.6;
            background-color: var(--bs-secondary-bg);
        }
        .sold-axe:hover {
            opacity: 0.8;
        }
        .theme-toggle-btn {
            background: none;
            border: none;
            color: #ffc107;
            font-size: 1.5rem;
            margin-left: 1rem;
            cursor: pointer;
        }
        .theme-toggle-btn .bi {
            vertical-align: middle;
        }
        .navbar, .navbar-dark, .bg-dark {
            background-color: #23272b !important;
        }
        /* Ta bort all egen bakgrundsfärg på html/body för tema, låt Bootstrap sköta det */
        
        /* Footer styling */
        .footer {
            background-color: var(--bs-body-bg);
            border-top: 1px solid var(--bs-border-color);
            margin-top: auto;
        }
        
        .footer h6 {
            color: var(--bs-body-color);
            font-size: 0.9rem;
        }
        
        .footer .text-muted {
            color: var(--bs-secondary-color) !important;
        }
        
        .footer a.text-muted:hover {
            color: var(--bs-primary) !important;
            transform: translateX(2px);
            transition: all 0.2s ease;
        }
        
        .footer .bi-heart-fill {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Säkerställ att body tar hela höjden */
        html, body {
            height: 100%;
        }
        
        body {
            display: flex;
            flex-direction: column;
        }
        
        .container.mt-4 {
            flex: 1;
        }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand" href="{% url 'axe_list' %}">
            <svg width="24" height="24" viewBox="-4 0 36 36" xmlns="http://www.w3.org/2000/svg" style="margin-right: 8px; vertical-align: middle;">
                <g fill="currentColor" fill-rule="evenodd" transform="translate(-10 -6)">
                    <path d="M26.5 24L29.5 24C30.0522847 24 30.5 24.4477153 30.5 25L30.5 39.5C30.5 40.8807119 29.3807119 42 28 42L28 42C26.6192881 42 25.5 40.8807119 25.5 39.5L25.5 25C25.5 24.4477153 25.9477153 24 26.5 24zM19.1482152 24.0027733C17.7224143 21.7188156 17.0063426 18.9528904 17 16.0002023 17.0063557 13.0413843 17.7253905 10.2846689 19.1571044 8.0002195 21.7006691 8.85610807 23.7916534 9.40696749 25.4300574 9.65279777 27.9284325 10.0276603 31.7618551 10.0514621 36.930325 9.72420332 37.4812749 9.68930526 37.9590975 10.0660075 37.9975707 10.5655785 37.9991897 10.5866016 38 10.6076695 38 10.6287439L38.0000181 21.3712416C38.0000181 21.8720312 37.5522948 22.2780013 37 22.2780013 31.7618614 21.9485389 27.9284346 21.9723405 25.4300574 22.3472033 23.7897452 22.5933199 21.6957978 23.1451766 19.1482152 24.0027733z"/>
                    <path d="M13.3597012,25.3487123 C11.1199004,22.2325423 10,19.1163723 10,16.0002023 C10,12.8854101 11.1189103,9.77061783 13.3567309,6.65582561 L13.3567108,6.6558137 C13.6215783,6.28714813 14.1399622,6.14409188 14.586314,6.31648519 C15.8505999,6.80478711 16.8319681,7.17873788 17.5304185,7.43833749 C15.8503589,9.82598584 15.0068861,12.7944738 15,16.0002023 C15.0068861,19.2059308 15.8503589,22.1915141 17.5304185,24.5791625 C16.831484,24.838942 15.8492394,25.2092147 14.5836849,25.6899807 L14.5836787,25.6899673 C14.13836,25.8591374 13.6233762,25.7155557 13.3597012,25.3487123 Z"/>
                </g>
            </svg>
            {{ site_settings.title|default:"Yxsamling" }}
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                                      <li class="nav-item">
                          <a class="nav-link" href="{% url 'axe_list' %}">Samling</a>
                      </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'axe_gallery' %}">Galleri</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'transaction_list' %}">Transaktioner</a>
                </li>
                {% if user.is_authenticated %}
                <li class="nav-item">
                   <a class="nav-link" href="{% url 'contact_list' %}">Kontakter</a>
               </li>
                {% elif public_settings.show_contacts %}
                <li class="nav-item">
                   <a class="nav-link" href="{% url 'contact_list' %}">Kontakter</a>
               </li>
                {% endif %}
                 <li class="nav-item">
                    <a class="nav-link" href="{% url 'manufacturer_list' %}">Tillverkare</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'stamp_list' %}">Stämplar</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'statistics_dashboard' %}">Statistik</a>
                </li>
            </ul>
            
            <!-- Global sökning -->
            <div class="navbar-nav me-3 position-relative">
                <div class="nav-item">
                    <input type="text" id="globalSearchInput" class="form-control form-control-sm" 
                           placeholder="Sök..." 
                           style="width: 250px; min-width: 200px;">
                    <div id="globalSearchResults" class="dropdown-menu w-100" 
                         style="display: none; position: absolute; z-index: 1050; max-height: 400px; overflow-y: auto; top: 100%; left: 0; right: 0;">
                        <!-- Sökresultat visas här -->
                    </div>
                </div>
            </div>
            
            <!-- Auth knappar -->
            <div class="navbar-nav me-3">
                {% if user.is_authenticated %}
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user me-1"></i>{{ user.username }}
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="userDropdown">
                            <li>
                                <a class="dropdown-item" href="{% url 'settings' %}">
                                    <i class="bi bi-gear me-2"></i>Inställningar
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'unlinked_images' %}">
                                    <i class="bi bi-images me-2"></i>Okopplade bilder
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form method="post" action="{% url 'logout' %}" style="display: inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="dropdown-item" style="border: none; background: none; width: 100%; text-align: left;">
                                        <i class="fas fa-sign-out-alt me-2"></i>Logga ut
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                {% else %}
                    <div class="nav-item">
                        <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i class="fas fa-sign-in-alt me-1"></i>Logga in
                        </button>
                    </div>
                {% endif %}
            </div>
            
            <button id="themeToggleBtn" class="theme-toggle-btn" title="Växla tema" aria-label="Växla tema">
                <i id="themeIcon" class="bi bi-moon"></i>
            </button>
        </div>
    </div>
</nav>

<div class="container mt-4">
    {% block content %}{% endblock %}
</div>

<!-- Footer -->
<footer class="footer mt-5 py-4 border-top">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-6 mb-3">
                <h6 class="fw-bold">
                    <svg width="24" height="24" viewBox="-4 0 36 36" xmlns="http://www.w3.org/2000/svg" style="margin-right: 8px; vertical-align: middle;">
                        <g fill="currentColor" fill-rule="evenodd" transform="translate(-10 -6)">
                            <path d="M26.5 24L29.5 24C30.0522847 24 30.5 24.4477153 30.5 25L30.5 39.5C30.5 40.8807119 29.3807119 42 28 42L28 42C26.6192881 42 25.5 40.8807119 25.5 39.5L25.5 25C25.5 24.4477153 25.9477153 24 26.5 24zM19.1482152 24.0027733C17.7224143 21.7188156 17.0063426 18.9528904 17 16.0002023 17.0063557 13.0413843 17.7253905 10.2846689 19.1571044 8.0002195 21.7006691 8.85610807 23.7916534 9.40696749 25.4300574 9.65279777 27.9284325 10.0276603 31.7618551 10.0514621 36.930325 9.72420332 37.4812749 9.68930526 37.9590975 10.0660075 37.9975707 10.5655785 37.9991897 10.5866016 38 10.6076695 38 10.6287439L38.0000181 21.3712416C38.0000181 21.8720312 37.5522948 22.2780013 37 22.2780013 31.7618614 21.9485389 27.9284346 21.9723405 25.4300574 22.3472033 23.7897452 22.5933199 21.6957978 23.1451766 19.1482152 24.0027733z"/>
                            <path d="M13.3597012,25.3487123 C11.1199004,22.2325423 10,19.1163723 10,16.0002023 C10,12.8854101 11.1189103,9.77061783 13.3567309,6.65582561 L13.3567108,6.6558137 C13.6215783,6.28714813 14.1399622,6.14409188 14.586314,6.31648519 C15.8505999,6.80478711 16.8319681,7.17873788 17.5304185,7.43833749 C15.8503589,9.82598584 15.0068861,12.7944738 15,16.0002023 C15.0068861,19.2059308 15.8503589,22.1915141 17.5304185,24.5791625 C16.831484,24.838942 15.8492394,25.2092147 14.5836849,25.6899807 L14.5836787,25.6899673 C14.13836,25.8591374 13.6233762,25.7155557 13.3597012,25.3487123 Z"/>
                        </g>
                    </svg>AxeCollection
                </h6>
                <p class="text-muted small mb-2">
                    Ett Django-baserat system för att hantera och katalogisera yxsamlingar.
                </p>
                <p class="text-muted small mb-0">
                    <i class="bi bi-code-square me-1"></i>
                    <span class="version-info">{{ app_version }}</span>
                </p>
            </div>
            
            <div class="col-lg-3 col-md-6 mb-3">
                <h6 class="fw-bold">Funktioner</h6>
                <ul class="list-unstyled small text-muted">
                    <li><i class="bi bi-check-circle me-1"></i>Yxhantering & katalogisering</li>
                    <li><i class="bi bi-check-circle me-1"></i>Avancerad bildhantering</li>
                    <li><i class="bi bi-check-circle me-1"></i>Transaktioner & statistik</li>
                    <li><i class="bi bi-check-circle me-1"></i>Måttregistrering</li>
                </ul>
            </div>
            
            <div class="col-lg-3 col-md-6 mb-3">
                <h6 class="fw-bold">Teknik</h6>
                <ul class="list-unstyled small text-muted">
                    <li><i class="bi bi-heart-fill text-success me-1"></i>Django 5.1</li>
                    <li><i class="bi bi-heart-fill text-primary me-1"></i>Bootstrap 5.3</li>
                    <li><i class="bi bi-heart-fill text-info me-1"></i>SQLite</li>
                    <li><i class="bi bi-heart-fill text-warning me-1"></i>JavaScript/AJAX</li>
                </ul>
            </div>
            
            <div class="col-lg-3 col-md-6 mb-3">
                <h6 class="fw-bold">Länkar</h6>
                <div class="d-flex flex-column">
                    <a href="https://github.com/Armandur/AxeCollection" class="text-decoration-none text-muted small mb-2" target="_blank">
                        <i class="bi bi-github me-2"></i>GitHub Repository
                    </a>
                    <a href="https://github.com/Armandur/AxeCollection/issues" class="text-decoration-none text-muted small mb-2" target="_blank">
                        <i class="bi bi-bug me-2"></i>Rapportera problem
                    </a>
                    <a href="https://github.com/Armandur/AxeCollection/blob/main/TODO_FEATURES.md" class="text-decoration-none text-muted small mb-2" target="_blank">
                        <i class="bi bi-list-check me-2"></i>Framtida funktioner
                    </a>
                </div>
            </div>
        </div>
        
        <hr class="my-3">
        
        <div class="row align-items-center">
            <div class="col-md-6">
                <p class="text-muted small mb-0">
                    © {{ current_year }} AxeCollection. Utvecklat med <i class="bi bi-heart-fill text-danger"></i> för yxentusiaster.
                </p>
            </div>
            <div class="col-md-6 text-md-end">
                <small class="text-muted">
                    <i class="bi bi-clock me-1"></i>Senast uppdaterad: <span class="build-date">{{ build_date|default:"2025-01-25" }}</span>
                </small>
            </div>
        </div>
    </div>
</footer>

<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">
                    <i class="fas fa-sign-in-alt me-2"></i>Inloggning
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if demo_mode %}
                <div class="alert alert-info mb-3">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Demo-läge:</strong> Använd <code>demo</code> som användarnamn och <code>demo123</code> som lösenord för att logga in.
                </div>
                {% endif %}
                
                <form method="post" action="{% url 'login' %}">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="username" class="form-label">
                            <i class="fas fa-user me-2"></i>Användarnamn
                        </label>
                        <input type="text" class="form-control" id="username" name="username" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="password" class="form-label">
                            <i class="fas fa-lock me-2"></i>Lösenord
                        </label>
                        <input type="password" class="form-control" id="password" name="password" required>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt me-2"></i>Logga in
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.bootstrap5.js"></script>
<script src="https://cdn.datatables.net/buttons/3.0.2/js/dataTables.buttons.js"></script>
<script src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.bootstrap5.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.colVis.min.js"></script>
<script src="https://cdn.datatables.net/responsive/3.0.2/js/dataTables.responsive.js"></script>
<script src="https://cdn.datatables.net/responsive/3.0.2/js/responsive.bootstrap5.js"></script>

{% include 'axes/_toast.html' %}
{% include 'axes/_confirm.html' %}

<script>
// Bootstrap 5.3 color mode hantering med tre lägen
(function() {
    function setTheme(theme) {
        if (theme === 'dark') {
            document.documentElement.setAttribute('data-bs-theme', 'dark');
            document.getElementById('themeIcon').className = 'bi bi-moon-fill';
        } else if (theme === 'light') {
            document.documentElement.setAttribute('data-bs-theme', 'light');
            document.getElementById('themeIcon').className = 'bi bi-sun-fill';
        } else {
            // Auto: följ OS
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-bs-theme', 'dark');
                document.getElementById('themeIcon').className = 'bi bi-circle-half';
            } else {
                document.documentElement.setAttribute('data-bs-theme', 'light');
                document.getElementById('themeIcon').className = 'bi bi-circle-half';
            }
        }
    }
    // Läs tema från localStorage
    var savedTheme = localStorage.getItem('theme');
    setTheme(savedTheme);
    // Lyssna på knapp
    document.getElementById('themeToggleBtn').addEventListener('click', function() {
        var savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            localStorage.setItem('theme', 'dark');
            setTheme('dark');
        } else if (savedTheme === 'dark') {
            localStorage.removeItem('theme');
            setTheme(null);
        } else {
            localStorage.setItem('theme', 'light');
            setTheme('light');
        }
    });
    // Lyssna på OS-temaändring
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
        if (!localStorage.getItem('theme')) {
            if (e.matches) {
                document.documentElement.setAttribute('data-bs-theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-bs-theme', 'light');
            }
        }
    });
})();

// Global sökning
(function() {
    const searchInput = document.getElementById('globalSearchInput');
    const searchResults = document.getElementById('globalSearchResults');
    let searchTimeout;
    
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const query = this.value.trim();
            clearTimeout(searchTimeout);
            
            if (query.length >= 2) {
                searchTimeout = setTimeout(() => {
                    // Visa laddningsindikator
                    searchResults.innerHTML = `
                        <div class="dropdown-item text-muted">
                            <i class="fas fa-spinner fa-spin me-2"></i>Söker efter "${query}"...
                        </div>
                    `;
                    searchResults.style.display = 'block';
                    
                    // Anropa backend
                    fetch(`{% url 'global_search' %}?q=${encodeURIComponent(query)}`)
                        .then(response => response.json())
                        .then(data => {
                            displayGlobalSearchResults(data.results, query);
                        })
                        .catch(error => {
                            console.error('Sökfel:', error);
                            searchResults.innerHTML = `
                                <div class="dropdown-item text-danger">
                                    <i class="fas fa-exclamation-triangle me-2"></i>Fel vid sökning
                                </div>
                            `;
                        });
                }, 300);
            } else {
                searchResults.style.display = 'none';
            }
        });
        
        // Dölj dropdown när användaren klickar utanför
        document.addEventListener('click', function(e) {
            if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                searchResults.style.display = 'none';
            }
        });
        
        // Kortkommando Ctrl+K för att fokusera sökfältet
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                searchInput.focus();
            }
        });
    }
    
    // Funktion för att visa globala sökresultat
    function displayGlobalSearchResults(results, query) {
        let html = '';
        let totalResults = 0;
        
        // Räkna totala resultat
        Object.values(results).forEach(group => totalResults += group.length);
        
        if (totalResults === 0) {
            html = `
                <div class="dropdown-item text-muted">
                    <i class="fas fa-search me-2"></i>Inga resultat för "${query}"
                </div>
            `;
        } else {
            // Yxor
            if (results.axes.length > 0) {
                html += `<div class="dropdown-header"><i class="fas fa-axe me-2"></i>Yxor (${results.axes.length})</div>`;
                results.axes.forEach(item => {
                    html += `
                        <a href="${item.url}" class="dropdown-item">
                            <div><strong>${item.title}</strong></div>
                            <small class="text-muted">${item.subtitle}</small>
                        </a>
                    `;
                });
            }
            
            // Kontakter
            if (results.contacts.length > 0) {
                html += `<div class="dropdown-header"><i class="fas fa-user me-2"></i>Kontakter (${results.contacts.length})</div>`;
                results.contacts.forEach(item => {
                    html += `
                        <a href="${item.url}" class="dropdown-item">
                            <div><strong>${item.title}</strong></div>
                            <small class="text-muted">${item.subtitle}</small>
                        </a>
                    `;
                });
            }
            
            // Tillverkare
            if (results.manufacturers.length > 0) {
                html += `<div class="dropdown-header"><i class="fas fa-industry me-2"></i>Tillverkare (${results.manufacturers.length})</div>`;
                results.manufacturers.forEach(item => {
                    html += `
                        <a href="${item.url}" class="dropdown-item">
                            <div><strong>${item.title}</strong></div>
                            <small class="text-muted">${item.subtitle}</small>
                        </a>
                    `;
                });
            }
            
            // Transaktioner
            if (results.transactions.length > 0) {
                html += `<div class="dropdown-header"><i class="fas fa-exchange-alt me-2"></i>Transaktioner (${results.transactions.length})</div>`;
                results.transactions.forEach(item => {
                    html += `
                        <a href="${item.url}" class="dropdown-item">
                            <div><strong>${item.title}</strong></div>
                            <small class="text-muted">${item.subtitle}</small>
                        </a>
                    `;
                });
            }
        }
        
        searchResults.innerHTML = html;
        searchResults.style.display = 'block';
    }
})();
</script>

{% block scripts %}{% endblock %}

</body>
</html> 